<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mysql To Go Struct</title>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5510947922469629"
     crossorigin="anonymous"></script>
  <script>
    let mysqlToGolang = {
      "int":"int",
      "bigint":"int",
      "float":"float32",
      "double":"float64",
      "bit":"int",
      "tinyint":"int",
      "decimal":"int",
      "char":"string",
      "varchar":"string",
      "tinytext":"string",
      "text":"string",
      "mediumtext":"string",
      "longtext":"string",
      "date":"time.Time",
      "datetime":"time.Time",
      "timestamp":"time.Time",
    };
    function toCamelCase(str) {
      return str.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g, (m, chr) => chr.toUpperCase());
    }
    function toPascalCase(str){
      let result = toCamelCase(str);
      result = result.charAt(0).toUpperCase() + result.slice(1);
      return result;
    }
    function convert(){
      let input = document.getElementById('input-textarea').value.split('\n');
      let tableName = "";
      let dataNames = [];
      let dataTypes = [];
      for(let i=0;i<input.length;i++){
        let line = input[i].trim();
        if(line == ""){
          continue;
        }
        if (line.startsWith("CREATE TABLE")){
          tableName = line.match(/['"`].*['"`]/g)[0].replaceAll(/['"`]/g,"");
          continue;
        }
        if (line.startsWith(")")){
          continue;
        }
        if (line.startsWith("PRIMARY") || line.startsWith("UNIQUE") || line.startsWith("KEY") || line.startsWith("CONSTRAINT")){
          continue;
        }
        let splitLine = line.split(' ');
        
        let dataName = splitLine[0].replace(/[`'"]/g,"");
        let dataType = splitLine[1].replace(/\([\.\d\D]*/g,"");

        dataNames.push(dataName);
        dataTypes.push(dataType);
      }
      let result = `type ${toPascalCase(tableName)} struct {\n`;
      for(let i=0;i<dataNames.length;i++){
        result += `\t${toPascalCase(dataNames[i])} ${mysqlToGolang[dataTypes[i]]} \`json:"${dataNames[i]}"\`\n`;
      }
      result += `}`;
      document.getElementById('result-textarea').value = result;
      }

      window.onload =  function () {
        document.getElementById('input-textarea').placeholder = `\n
CREATE TABLE \'test\' (
\'id_id\' int(11) unsigned NOT NULL AUTO_INCREMENT,
\'dsf\' bigint(20) DEFAULT NULL,
\'asdfasdf\' float DEFAULT NULL,
\'sadfasdf\' double DEFAULT NULL,
\'dsffsd\' bit(11) DEFAULT NULL,
\'xzcxzc\' tinyint(1) DEFAULT NULL,
\'er4t3tfd\' decimal(10,0) DEFAULT NULL,
\'sadfasfd\' char(1) DEFAULT NULL,
\'asdfsfadsdf\' varchar(50) DEFAULT NULL,
\'cvxzfdgsdfg\' tinytext DEFAULT NULL,
\'gfhfghfghhg\' text DEFAULT NULL,
\'vcxbxbcv\' mediumtext DEFAULT NULL,
\'cxbvxcvbxbcv\' longtext DEFAULT NULL,
\'jmhhmjhjm\' date DEFAULT NULL,
\'hmjnhmj\' datetime DEFAULT NULL,
\'mhjhmjhjm\' timestamp NULL DEFAULT NULL,
PRIMARY KEY (\'id\')
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
    `;
      }
  </script>
</head>
<body>
  <h1>Mysql SQL 문을 이용하여, Go Struct를 생성합니다.</h1>
  <textarea id="input-textarea" style="width: 600px;height: 600px;"></textarea>
  <br>
  <button id="convert-button" style="width: 600px;" onclick="convert();">Convert</button>
  <br>
  <textarea id="result-textarea" style="width: 600px;height: 600px;"></textarea>
</body>
</html>