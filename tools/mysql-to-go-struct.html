<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mysql To Go Struct</title>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5510947922469629"
     crossorigin="anonymous"></script>
  <script>
    let mysqlToGolang = {
      "int":"int",
      "bigint":"int",
      "float":"float32",
      "double":"float64",
      "bit":"int",
      "tinyint":"int",
      "decimal":"int",
      "char":"string",
      "varchar":"string",
      "tinytext":"string",
      "text":"string",
      "mediumtext":"string",
      "longtext":"string",
      "date":"time.Time",
      "datetime":"time.Time",
      "timestamp":"time.Time",
      "enum":"string",
    };
    function toCamelCase(str) {
      return str.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g, (m, chr) => chr.toUpperCase());
    }
    function toPascalCase(str){
      let result = toCamelCase(str);
      result = result.charAt(0).toUpperCase() + result.slice(1);
      return result;
    }
    function convert(){
      let input = document.getElementById('input-textarea').value.split('\n');
      let tableName = "";
      let dataNames = [];
      let dataTypes = [];
      for(let i=0;i<input.length;i++){
        let line = input[i].trim();
        if(line == ""){
          continue;
        }
        if (line.startsWith("CREATE TABLE")){
          tableName = line.match(/['"`].*['"`]/g)[0].replaceAll(/['"`]/g,"");
          continue;
        }
        if (line.startsWith(")")){
          continue;
        }
        if (line.startsWith("PRIMARY") || line.startsWith("UNIQUE") || line.startsWith("KEY") || line.startsWith("CONSTRAINT")){
          continue;
        }
        let splitLine = line.split(' ');
        
        let dataName = splitLine[0].replace(/[`'"]/g,"");
        let dataType = splitLine[1].replace(/\([\.\d\D]*/g,"");

        dataNames.push(dataName);
        dataTypes.push(dataType);
      }
      let result = `type ${toPascalCase(tableName)} struct {\n`;
      for(let i=0;i<dataNames.length;i++){
        result += `\t${toPascalCase(dataNames[i])} ${mysqlToGolang[dataTypes[i]]} \`json:"${dataNames[i]}"\`\n`;
      }
      result += `}`;
      document.getElementById('result-textarea').value = result;
      }
  </script>
</head>
<body>
  <h1>Mysql SQL 문을 이용하여, Go Struct를 생성합니다.</h1>
  <textarea id="input-textarea" style="width: 600px;height: 600px;" placeholder="CREATE TABLE `diary` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `text` text DEFAULT NULL,
    `time` datetime NOT NULL DEFAULT current_timestamp(),
    `writer` text DEFAULT NULL,
    `discord_id` bigint(20) DEFAULT NULL,
    `kakao_id` bigint(20) DEFAULT NULL,
    `email_id` int(11) DEFAULT NULL,
    PRIMARY KEY (`id`)
  ) ENGINE=InnoDB AUTO_INCREMENT=1089 DEFAULT CHARSET=utf8mb4;"></textarea>
  <br>
  <button id="convert-button" style="width: 600px;" onclick="convert();">Convert</button>
  <br>
  <textarea id="result-textarea" style="width: 600px;height: 600px;" placeholder='type Diary struct {
    Id int `json:"id"`
    Text string `json:"text"`
    Time time.Time `json:"time"`
    Writer string `json:"writer"`
    DiscordId int `json:"discord_id"`
    KakaoId int `json:"kakao_id"`
    EmailId int `json:"email_id"`
}'></textarea>
</body>
</html>